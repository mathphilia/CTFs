# Choice
category: Crypto  
168 points, 31 solves

## 問題
> Can you make the right choice? 
>  
> `nc choice.beginners.seccon.games 1336`

## 解法
$N$ が $3$ つの素数 $p,q,r$ の積になっているRSA暗号。 $N=pqr,s=pq+qr+rp$ が与えられるので、あとは $p+q+r$ が分かれば $p,q,r$ を求めることができる(詳しい求め方は後述)。さて、 $N$ 以上の整数$a$を指定すると $p^a+q^a+r^a\bmod N$ を教えてもらえるわけだが、この式を見ると思うところがある。これ、四項間漸化式の解になるな、と。具体的には、任意の整数 $k$ に対して

$$p^{k+3}+q^{k+3}+r^{k+3}=(p+q+r)(p^{k+2}+q^{k+2}+r^{k+2})-(pq+qr+rp)(p^{k+1}+q^{k+1}+r^{k+1})+pqr(p^k+q^k+r^k)$$

が成り立つ。よって、 $i=N,N+1,N+2,N+3$ (この値は適当)に対して $p^i+q^i+r^i\bmod N$ を訊けば上式の未知数は $p+q+r$ のみになる。これにより $p+q+r$ が求まる(以下 $t=p+q+r$ とおく)ので、 $3$ 次方程式 $x^3-tx^2+sx-N=0$ を解くことにより $p,q,r$ を得る。ちなみに、 $p,q,r$ が大きすぎるせいでこのクエリの返答が来るまで $3$ 秒ずつほどかかる。 
では、 $3$ 次方程式をどう解けばよいだろうか。色々方法はあると思うが、今回はNewton法を使う。 $\bmod$ 付きでない整数係数代数方程式の整数解を求めるときは、この方法が有用である。ただし、桁落ちを防ぐためにfloat型の割り算ではなくint型の割り算を使うことになるため収束値が真の解からずれる恐れがある。とはいえそのずれは小さいので、収束値周辺を探索すれば解は見つかる。

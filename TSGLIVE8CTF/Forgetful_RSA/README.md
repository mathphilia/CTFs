# Forgetful RSA
category: Crypto
200 points, 9 solves

## 問題
> 俺は忘れっぽいから、暗号文を何回もメモって… おっと、公開鍵をメモっとくのを忘れてた！

## 解法
m, m//2, m//4, …を暗号化したものが与えられているので、Franklin-Reiter related message attack(後述)が使えそうである。しかし、これを使うには公開鍵Nが必要となるので、以下ではNを求める方法を考える。  
リストcの末尾を見ると後ろから順に0<sup>257</sup>, 1<sup>257</sup>, 2<sup>257</sup>, 5<sup>257</sup>, 10<sup>257</sup>, …と並んでいる。なので次に来る`c[-6]`は20<sup>257</sup>か21<sup>257</sup>であるはずだが、Nより大きいのでNで割った余りになっている。同様にして`c[-7]`は、`c[-6]`が20<sup>257</sup>%Nなら40<sup>257</sup>%Nか41<sup>257</sup>%N、`c[-6]`が21<sup>257</sup>%Nなら42<sup>257</sup>%Nか43<sup>257</sup>%Nとなる。さて、20<sup>257</sup>をNで割った余りが`c[-6]`であるとすると、20<sup>257</sup>-`c[-6]`がNの倍数ということになる。つまり、`c[-6]`=20<sup>257</sup>%Nかつ`c[-7]`=40<sup>257</sup>%Nであるとしたらgcd(20<sup>257</sup>-`c[-6]`, 40<sup>257</sup>`c[-7]`)はNの倍数になる。実際に計算してみるとgcd(21<sup>257</sup>-`c[-6]`, 42<sup>257</sup>`c[-7]`)が1024bitの奇数なので、まず間違いなくこれがNである。  
以上でNが求まったのでFranklin-Reiter related message attackを行う。なお、以下では常にmod Nで考えるものとする。まず、flagの末尾は`}`(0x7d)なので、平文は奇数である。そのため、x=m//2とすれば、m=2x+1となる。2x+1を暗号化すると`c[0]`になり、xを暗号化すると`c[1]`になる、という関係を数式で表すと(2x+1)<sup>257</sup>=`c[0]`, x<sup>257</sup>=`c[1]`となる。このとき、(2x+1)<sup>257</sup>-`c[0]`とx<sup>257</sup>-`c[1]`は共にm//2を根に持つので、x- m//2で割り切れる。よって、(2x+1)<sup>257</sup>-`c[0]`とx<sup>257</sup>-`c[1]`の(多項式としての)最大公約数をとればx- m//2の倍数となり、おそらくはx- m//2が出てくる。この方法がFranklin-Reiter related message attackである。
